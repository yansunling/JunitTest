select concat(main.salesman,'(',main.salesman_id,')') AS salesman , -- 销售人员 date_format(main.ticket_time, '%Y-%m-%d') AS ticket_time , -- 开单时间 sum( if( cust.loss_back_time >= concat( date_format(date_sub(curdate(), interval 6 month), '%Y-%m'), '-01' ), main.goods_cube, 0 ) ) AS total_month_goods_cube , -- 体积合计(m³) sum( if( cust.loss_back_time >= concat( date_format(date_sub(curdate(), interval 6 month), '%Y-%m'), '-01' ), main.goods_weight, 0 ) ) AS total_month_goods_weight , -- 重量合计(kg) round( sum( if( cust.loss_back_time >= concat( date_format(date_sub(curdate(), interval 6 month), '%Y-%m'), '-01' ),( tf.fee_actual_1000 + tf.fee_actual_1004 + tf.fee_actual_4000 + tf.fee_actual_2007 ), 0 ) ) / 100 ) AS total_month_line_amount , -- 干线收入合计 sum( if( cust.loss_back_time >= date_add(curdate(), interval - day(curdate()) + 1 day), main.goods_cube, 0 ) ) AS this_month_goods_cube , -- 体积(m³) sum( if( cust.loss_back_time >= date_add(curdate(), interval - day(curdate()) + 1 day), main.goods_weight, 0 ) ) AS this_month_goods_weight , -- 重量(kg) round( sum( if( cust.loss_back_time >= date_add(curdate(), interval - day(curdate()) + 1 day),( tf.fee_actual_1000 + tf.fee_actual_1004 + tf.fee_actual_4000 + tf.fee_actual_2007 ), 0 ) ) / 100 ) AS this_month_line_amount , -- 当月新增客户干线收入 sum( if( cust.loss_back_time >= concat( date_format(date_sub(curdate(), interval 1 month), '%Y-%m'), '-01' ) and cust.loss_back_time < date_add(curdate(), interval - day(curdate()) + 1 day), main.goods_cube, 0 ) ) AS one_month_goods_cubue , -- 体积(m³) sum( if( cust.loss_back_time >= concat( date_format(date_sub(curdate(), interval 1 month), '%Y-%m'), '-01' ) and cust.loss_back_time < date_add(curdate(), interval - day(curdate()) + 1 day), main.goods_cube, 0 ) ) AS one_month_goods_weight , -- 重量(kg) round( sum( if( cust.loss_back_time >= concat( date_format(date_sub(curdate(), interval 1 month), '%Y-%m'), '-01' ) and cust.loss_back_time < date_add(curdate(), interval - day(curdate()) + 1 day),( tf.fee_actual_1000 + tf.fee_actual_1004 + tf.fee_actual_4000 + tf.fee_actual_2007 ), 0 ) ) / 100 ) AS one_month_line_amount , -- 干线收入 sum( if( cust.loss_back_time >= concat( date_format(date_sub(curdate(), interval 2 month), '%Y-%m'), '-01' ) and cust.loss_back_time < concat( date_format(date_sub(curdate(), interval 1 month), '%Y-%m'), '-01' ), main.goods_cube, 0 ) ) AS two_month_goods_cubue , -- 体积(m³) sum( if( cust.loss_back_time >= concat( date_format(date_sub(curdate(), interval 2 month), '%Y-%m'), '-01' ) and cust.loss_back_time < concat( date_format(date_sub(curdate(), interval 1 month), '%Y-%m'), '-01' ), main.goods_weight, 0 ) ) AS two_month_goods_weight , -- 重量(kg) round( sum( if( cust.loss_back_time >= concat( date_format(date_sub(curdate(), interval 2 month), '%Y-%m'), '-01' ) and cust.loss_back_time < concat( date_format(date_sub(curdate(), interval 1 month), '%Y-%m'), '-01' ),( tf.fee_actual_1000 + tf.fee_actual_1004 + tf.fee_actual_4000 + tf.fee_actual_2007 ), 0 ) ) / 100 ) AS two_month_line_amount , -- 干线收入 sum( if( cust.loss_back_time >= concat( date_format(date_sub(curdate(), interval 3 month), '%Y-%m'), '-01' ) and cust.loss_back_time < concat( date_format(date_sub(curdate(), interval 2 month), '%Y-%m'), '-01' ), main.goods_cube, 0 ) ) AS three_month_goods_cubue , -- 体积(m³) sum( if( cust.loss_back_time >= concat( date_format(date_sub(curdate(), interval 3 month), '%Y-%m'), '-01' ) and cust.loss_back_time < concat( date_format(date_sub(curdate(), interval 2 month), '%Y-%m'), '-01' ), main.goods_weight, 0 ) ) AS three_month_goods_weight , -- 重量(kg) round( sum( if( cust.loss_back_time >= concat( date_format(date_sub(curdate(), interval 3 month), '%Y-%m'), '-01' ) and cust.loss_back_time < concat( date_format(date_sub(curdate(), interval 2 month), '%Y-%m'), '-01' ),( tf.fee_actual_1000 + tf.fee_actual_1004 + tf.fee_actual_4000 + tf.fee_actual_2007 ), 0 ) ) / 100 ) AS three_month_line_amount , -- 干线收入 sum( if( cust.loss_back_time >= concat( date_format(date_sub(curdate(), interval 4 month), '%Y-%m'), '-01' ) and cust.loss_back_time < concat( date_format(date_sub(curdate(), interval 3 month), '%Y-%m'), '-01' ), main.goods_cube, 0 ) ) AS four_month_goods_cubue , -- 体积(m³) sum( if( cust.loss_back_time >= concat( date_format(date_sub(curdate(), interval 4 month), '%Y-%m'), '-01' ) and cust.loss_back_time < concat( date_format(date_sub(curdate(), interval 3 month), '%Y-%m'), '-01' ), main.goods_weight, 0 ) ) AS four_month_goods_weight , -- 重量(kg) round( sum( if( cust.loss_back_time >= concat( date_format(date_sub(curdate(), interval 4 month), '%Y-%m'), '-01' ) and cust.loss_back_time < concat( date_format(date_sub(curdate(), interval 3 month), '%Y-%m'), '-01' ),( tf.fee_actual_1000 + tf.fee_actual_1004 + tf.fee_actual_4000 + tf.fee_actual_2007 ), 0 ) ) / 100 ) AS four_month_line_amount , -- 干线收入 sum( if( cust.loss_back_time >= concat( date_format(date_sub(curdate(), interval 5 month), '%Y-%m'), '-01' ) and cust.loss_back_time < concat( date_format(date_sub(curdate(), interval 4 month), '%Y-%m'), '-01' ), main.goods_cube, 0 ) ) AS five_month_goods_cubue , -- 体积(m³) sum( if( cust.loss_back_time >= concat( date_format(date_sub(curdate(), interval 5 month), '%Y-%m'), '-01' ) and cust.loss_back_time < concat( date_format(date_sub(curdate(), interval 4 month), '%Y-%m'), '-01' ), main.goods_weight, 0 ) ) AS five_month_goods_weight , -- 重量(kg) round( sum( if( cust.loss_back_time >= concat( date_format(date_sub(curdate(), interval 5 month), '%Y-%m'), '-01' ) and cust.loss_back_time < concat( date_format(date_sub(curdate(), interval 4 month), '%Y-%m'), '-01' ),( tf.fee_actual_1000 + tf.fee_actual_1004 + tf.fee_actual_4000 + tf.fee_actual_2007 ), 0 ) ) / 100 ) AS five_month_line_amount , -- 干线收入 sum( if( cust.loss_back_time >= concat( date_format(date_sub(curdate(), interval 6 month), '%Y-%m'), '-01' ) and cust.loss_back_time < concat( date_format(date_sub(curdate(), interval 5 month), '%Y-%m'), '-01' ), main.goods_cube, 0 ) ) AS six_month_goods_cubue , -- 体积(m³) sum( if( cust.loss_back_time >= concat( date_format(date_sub(curdate(), interval 6 month), '%Y-%m'), '-01' ) and cust.loss_back_time < concat( date_format(date_sub(curdate(), interval 5 month), '%Y-%m'), '-01' ), main.goods_weight, 0 ) ) AS six_month_goods_weight , -- 重量(kg) round( sum( if( cust.loss_back_time >= concat( date_format(date_sub(curdate(), interval 6 month), '%Y-%m'), '-01' ) and cust.loss_back_time < concat( date_format(date_sub(curdate(), interval 5 month), '%Y-%m'), '-01' ),( tf.fee_actual_1000 + tf.fee_actual_1004 + tf.fee_actual_4000 + tf.fee_actual_2007 ), 0 ) ) / 100 ) AS six_month_line_amount , -- 干线收入 main.salesman_id AS salesman_id, -- 销售id info.org_id,-- 所属大区 info.org_name -- 所属大区 from tmsp.tmsp_order_profile main left join tmsp.tmsp_order_detail detail on main.order_id = detail.order_id left join tmsp.tmsp_order_fee_detail tf on main.order_id = tf.order_id left join crm.crm_base_customer_detail cust on cust.cust_loss_back='Y' and cust.customer_id = if( detail.delivery_decision = '前端', main.send_customer_id, main.recv_customer_id ) left join hcm.hcm_emp_ent ent on ent.emp_id=main.salesman_id left join mdm.mdm_hcm_org_relation relation on relation.org_id=ent.dept left join mdm.mdm_hcm_org_info info on info.org_id=relation.business_region_id where main.ticket_time >= date_add(date_sub(curdate(),interval 1 month), interval -day(curdate())+1 day) and main.ticket_time < date_add(curdate(), interval -day(curdate())+1 day) and main.ticket_time >= concat(date_format(date_sub(now(),interval 3 month),'%Y-%m'),'-01') and order_close_type != 'invalid' and order_status != 'pre' and main.salesman_id!='' group by date_format(main.ticket_time, '%Y-%m-%d'), main.salesman_id order by main.salesman_id,date_format(main.ticket_time, '%Y-%m-%d')